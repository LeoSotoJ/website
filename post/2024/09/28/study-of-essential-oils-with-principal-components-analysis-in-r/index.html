<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    

    <title>Study of Essential Oils with Principal Components Analysis in R | Leonardo Soto</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
  </head>
  <body>
  <header class="bg"></header>
  <div class="layout">
  
  <div class="header"><h1><a href="/" style="color: #fff; text-decoration: underline; text-decoration-style: dotted;">Leonardo</a></h1></div>
    <nav class="navbar navbar-expand sticky-top navbar-nav-scroll navbar-dark">
    <ul class="navbar-nav" style="padding: 5px;">
      <li class="nav-item" style="margin-left: -5px;"><a class="nav-link active" href="/" style="margin-left: 15px;">Home</a></li>      
      <li class="nav-item" style="margin-left: -5px;"><a class="nav-link active" href="/post/" style="margin-left: 15px;">Posts</a></li>      
      <li class="nav-item" style="margin-left: -5px;"><a class="nav-link active" href="/contact/" style="margin-left: 15px;">Contact</a></li>      
      <li class="nav-item" style="margin-left: -5px;"><a class="nav-link active" href="/index.xml" style="margin-left: 15px;">RSS</a></li>      
    </ul>
    </nav>

<div class="content">
<div class="article-meta">
<h1><span class="title">Study of Essential Oils with Principal Components Analysis in R</span></h1>
<p class="author">LS 
| <span class="date">2024/09/28</span></p>
</div>


<p style="text-align: center;">

<a class="badge badge-secondary" href="/tags/chemometrics"> #chemometrics</a>

</p>






<main>
<p>Principal Component Analysis (PCA) is a statistical technique to analyze high-dimensional data that uses linear combinations of the original variables to capture the maximum variance of the data. The main uses of PCA are dimension reduction and patterns identification. This post describes the PCA workflow and the step-to-step process applied to an analytical chemistry example using R.</p>
<h1 id="1-workflow">1. Workflow</h1>
<p>Briefly, one can start by defining the aim of the analysis. Then, examining the raw data and pre-processing it for outliers, centering, scaling, and feature selection. Centering and scaling can also be done directly with the PCA function in R.</p>
<p>Once the data is pre-processed, apply the PCA analysis in R, which calculates:</p>
<ul>
<li>Covariance/Correlation matrix: relationships between variables</li>
<li>Eigenvectors and Eigenvalues: directions and their relative importance</li>
<li>New variables: data transformation</li>
</ul>
<p>After examining the PCA results:</p>
<ul>
<li>Select the number of principal components to keep</li>
<li>Plot the results</li>
</ul>
<h1 id="2-example-chemical-composition-of-essential-oils-from-different-plants-by-gm-ms-analysis">2. Example: Chemical composition of essential oils from different plants by GM-MS analysis</h1>
<p><strong>R script and data:</strong> <a href="https://github.com/LeoSotoJ/pca-essential-oils">pca-essential-oils <i class="bi bi-github"></i> </a></p>
<p>The chemical composition data is provided by <a href="https://doi.org/10.3390/molecules28114439">Benomari FZ et al.</a> <sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>. Actually, there are two tables, (1) oils grouped in 8 chemical classes and (2) a supplementary table with all the essential oils concentrations. We will use the last mentioned.</p>
<p>The <strong>aim</strong> of this data analysis is to obtain insights about the oils concentrations and their possible patterns or grouping tendencies.</p>
<p>The essential oils profiles might also be related to factors such as species, age, weather seasons, and geographic location, for which the data could be further examined.</p>
<p>The <strong>pre-processing</strong> includes imputation of empty cells and trace labels. On this example, empty cells and trace labels will be considered as zero values. Additionally, one variable did not have values for any of the plants therefore it was removed.</p>
<p>In total, there are 14 samples and 121 variables. Ideally, it is preferred to work with a number of samples that greatly exceeds the number of variables by many times. A feature selection step could be considered, for example a filter of variance threshold would remove low variance features that contribute little information. However, for the purpose of this example, we will proceed with the entire dataset.</p>
<p>For the <strong>analysis</strong> in R we can start by setting the working directory and loading the dataset,</p>
<pre><code>setwd(&quot;the/working/directory&quot;)
dataset &lt;- read.csv(&quot;dataset.csv&quot;, 
             header = TRUE,    
             sep = &quot;;&quot;,
             stringsAsFactors = FALSE)
</code></pre>
<p>Examine the data with</p>
<pre><code>head(dataset)
</code></pre>
<p>Set the PCA model. In this case we will center and do not apply scaling as the chemical composition is in percentage.</p>
<pre><code>PCA &lt;- prcomp(dataset[,3:123],center = T,scale. = F)
</code></pre>
<p>Notice that the sum of eigenvalues is equivalent to the sum of the diagonal of the covariance matrix, both express the total variance.</p>
<pre><code>covariance &lt;- cov(dataset[,3:123])
sum(diag(covariance))
eigenvalues &lt;- PCA$sdev^2
sum(eigenvalues)
</code></pre>
<p>Get the summary of PCs and note the importance of each PC,</p>
<pre><code>summary(PCA)

Importance of components:
    	                   PC1     PC2     PC3      PC4      PC5      PC6      PC7     PC8     PC9    PC10    PC11    PC12    PC13      PC14
Standard deviation     33.1651 24.5291 19.6369 14.55046 14.34261 10.64161 10.07339 6.80940 6.01272 2.47266 2.03735 1.33698 0.97587 4.954e-15
Proportion of Variance  0.3907  0.2137  0.1370  0.07521  0.07308  0.04023  0.03605 0.01647 0.01284 0.00217 0.00147 0.00064 0.00034 0.000e+00
Cumulative Proportion   0.3907  0.6045  0.7415  0.81671  0.88978  0.93002  0.96606 0.98254 0.99538 0.99755 0.99903 0.99966 1.00000 1.000e+00
</code></pre>
<p>Examine the contribution of each PC with a plot</p>
<pre><code>screeplot(PCA,npcs = 7,type = &quot;lines&quot;)
</code></pre>
<p><img src="img/screeplot.png" alt="screeplot"></p>
<p>The <strong>number of PCs to keep</strong> will be 3, reaching a cumulative proportion of 0.7415. We do not choose more than 3 in order to plot it in a 3 dimensions graph. Also, it might be possible to plot various combinations of significant PCs to examine patterns. Normally, PCs with a proportion of variance greater that 1% are considered significant.</p>
<p>We will plot the 3 first PCs as follows,</p>
<pre><code>dataset$Genus &lt;- as.factor(dataset$Genus)
PCAscores &lt;- as.data.frame(PCA$x[, 1:3])
Genus_colors &lt;- rainbow(nlevels(dataset$Genus))[as.integer(dataset$Genus)]
library(rgl)
plot3d(PCAscores[, 1:3], 
   		col = Genus_colors,
   		size = 3, 
   		xlab = &quot;PC1&quot;, 
   		ylab = &quot;PC2&quot;, 
   		zlab = &quot;PC3&quot;, 
   		main = &quot;3D PCA Scores&quot;)
rglwidget()
</code></pre>
<p><img src="img/3dpca.png" alt="screeplot">
<img src="img/3dpca2.png" alt="screeplot"></p>
<p>To plot 2 PCs we can use instead</p>
<pre><code>plot(PCAscores[,-3], main=&quot;Scores&quot;, col = Genus_colors, pch = 15)
legend(&quot;topright&quot;, 
   	legend = levels(dataset$Genus), 
   	col = rainbow(nlevels(dataset$Genus)), 
   	pch = 15, 
   	title = &quot;Genus&quot;)
</code></pre>
<p><img src="img/2dpca-l.png" alt="screeplot"></p>
<p>Despite the low number of samples, the 3D and 2D PCA plot show certain trends, some of them noted by Benomari FZ et al.<sup id="fnref1:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>:</p>
<ul>
<li>Two <em>Thymus</em> species (in purple) were clearly differentiated in the lowest PC1 and highest PC2. This pair will also be difficult to disgregate by PCA.</li>
<li>Also the graphs showed that the two <em>Lavandula</em> species differed greatly, and that <em>Lavandula Aspic</em> is closest to the <em>Eucalyptus Radiata</em> and <em>Eucalyptus Globulus</em> species. Benomari FZ et al.<sup id="fnref2:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup> noted that <em>Lavandula Aspic</em> and <em>Eucalyptus Globulus</em> share high concentrations of 1,8-cineol and similar medical use.</li>
<li>At the same time, some species of <em>Mentha</em>, <em>Thymus</em>, <em>Rosmarinus</em>, <em>Lavandula</em> grouped together sharing common traits, but all <em>Eucalyptus</em> species are most likely to be distinguished from the other aromatic plants.</li>
</ul>
<p>PCA would also be helpful in identifying similar therapeutic applications of essential oils. To further study the grouping tendencies in PCA of these aromatic and medicinal plants, it could be useful to process all individual sample analysis data rather than averaged concentrations.</p>
<h2 id="references">References</h2>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>Benomari, F.Z.; Sarazin, M.; Chaib, D.; Pichette, A.; Boumghar, H.; Boumghar, Y.; Djabou, N. Chemical Variability and Chemotype Concept of Essential Oils from Algerian Wild Plants. Molecules 2023, 28, 4439. <a href="https://doi.org/10.3390/molecules28114439">doi: 10.3390/molecules28114439</a>&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a>&#160;<a href="#fnref1:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a>&#160;<a href="#fnref2:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>

</main>
   <footer class="footer"> <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<script src="//cdn.jsdelivr.net/combine/npm/katex/dist/katex.min.js,npm/katex/dist/contrib/auto-render.min.js,npm/@xiee/utils/js/render-katex.js" defer></script>
<script src="//cdn.jsdelivr.net/npm/@xiee/utils/js/center-img.min.js" defer></script>
 
  <hr/>
  © <a href="/">Leonardo Soto</a> 2024 | <a href="https://github.com/LeoSotoJ?tab=repositories">GitHub</a> 
  </footer>
  </body>
</html>

</div>

